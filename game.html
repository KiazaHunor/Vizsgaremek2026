<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fut Draft</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body {
    background: linear-gradient(135deg, #0f2027, #203a43, #2c7744);
    font-family: 'Segoe UI', sans-serif;
    text-align: center;
}
.formation-container { margin-top: 50px; }
.formation-row { margin: 40px 0; }
.player {
    border: 2px solid black;
    background-color: white;
    font-weight: bold;
    width: 130px;
    height: 80px;
    display: inline-block;
    margin: 10px;
    line-height: 80px;
    opacity: 0;
    transform: translateY(-20px);
    transition: all 0.5s ease;
    cursor: pointer;
    position: relative;
}
.player.show { opacity: 1; transform: translateY(0); }
.player-options {
    position: absolute;
    top: 90px;
    left: 50%;
    transform: translateX(-50%);
    background-color: white;
    border: 2px solid black;
    z-index: 10;
    padding: 5px;
    display: none;
}
.player-options div {
    padding: 5px 10px;
    cursor: pointer;
}
.player-options div:hover {
    background-color: #28a745;
    color: white;
}
.btn { margin: 5px; }
</style>
</head>
<body>
<div class="container">
    <h1 id="cim" class="text-light mb-4">Válassz pozíciót</h1>
    <div id="formaciok" class="mb-4">
        <button class="btn btn-outline-success text-light fw-bold" onclick="loadFormation('4-1-2-1-2')">4-1-2-1-2</button>
        <button class="btn btn-outline-success text-light fw-bold" onclick="loadFormation('4-3-3')">4-3-3</button>
        <button class="btn btn-outline-success text-light fw-bold" onclick="loadFormation('4-4-2')">4-4-2</button>
    </div>
    <div id="formation-container" class="formation-container"></div>
</div>

<script>
function loadPlayers(button, position) {
    fetch("getPlayers.php?position=" + encodeURIComponent(position))
    .then(res => res.json())
    .then(data => {
        if(data.error) { alert("Hiba: " + data.error); return; }
        if(data.length === 0) { alert("Nincs játékos ezen a pozíción."); return; }

        // Véletlenszerűen 5 játékos kiválasztása
        data.sort(() => Math.random() - 0.5);
        const players = data.slice(0,5);

        // Options div létrehozása
        let html = '';
        players.forEach((p, i) => {
            html += `<div onclick="selectPlayer(this, '${p.name}', '${p.team}', '${p.position}', '${p.nationality}')">
                        ${p.name} (${p.team})
                     </div>`;
        });

        let optionsDiv = button.querySelector('.player-options');
        if(!optionsDiv) {
            optionsDiv = document.createElement('div');
            optionsDiv.className = 'player-options';
            button.appendChild(optionsDiv);
        }
        optionsDiv.innerHTML = html;
        optionsDiv.style.display = 'block';
    })
    .catch(err => { console.error(err); alert("Hiba az adatlekérés során."); });
}

function selectPlayer(div, name, team, position, nationality) {
    const parentButton = div.parentElement.parentElement;
    parentButton.innerHTML = `${name}<br>${team}<br>${position}<br>${nationality}`;
}

function loadFormation(formation) {
    document.getElementById("cim").innerHTML = "Állítsd össze a csapatodat";
    document.getElementById("formaciok").style.display = "none";
    const container = document.getElementById('formation-container');
    let html = "";

    const createPlayer = (posLabel, posValue) => {
        return `<div class="player" onclick="loadPlayers(this, '${posValue}')">${posLabel}</div>`;
    };

    if (formation === '4-3-3') {
        html = `
        <div class="formation-row">
            ${createPlayer('LW','left-winger')}
            ${createPlayer('CF','centre-forward')}
            ${createPlayer('RW','right-winger')}
        </div>
        <div class="formation-row">
            ${createPlayer('CM','central-midfield')}
            ${createPlayer('CAM','attacking-midfield')}
            ${createPlayer('CM','central-midfield')}
        </div>
        <div class="formation-row">
            ${createPlayer('LB','left-back')}
            ${createPlayer('CB','centre-back')}
            ${createPlayer('CB','centre-back')}
            ${createPlayer('RB','right-back')}
        </div>
        <div class="formation-row">
            ${createPlayer('GK','goalkeeper')}
        </div>`;
    } else if (formation === '4-1-2-1-2') {
        html = `
        <div class="formation-row">
            ${createPlayer('CF','centre-forward')}
            ${createPlayer('CF','centre-forward')}
        </div>
        <div class="formation-row">
            ${createPlayer('CAM','attacking-midfield')}
        </div>
        <div class="formation-row">
            ${createPlayer('CM','central-midfield')}
            ${createPlayer('CM','central-midfield')}
        </div>
        <div class="formation-row">
            ${createPlayer('CDM','defensive-midfield')}
        </div>
        <div class="formation-row">
            ${createPlayer('LB','left-back')}
            ${createPlayer('CB','centre-back')}
            ${createPlayer('CB','centre-back')}
            ${createPlayer('RB','right-back')}
        </div>
        <div class="formation-row">
            ${createPlayer('GK','goalkeeper')}
        </div>`;
    } else if (formation === '4-4-2') {
        html = `
        <div class="formation-row">
            ${createPlayer('CF','centre-forward')}
            ${createPlayer('CF','centre-forward')}
        </div>
        <div class="formation-row">
            ${createPlayer('LM','left-midfield')}
            ${createPlayer('CM','central-midfield')}
            ${createPlayer('CM','central-midfield')}
            ${createPlayer('RM','right-midfield')}
        </div>
        <div class="formation-row">
            ${createPlayer('LB','left-back')}
            ${createPlayer('CB','centre-back')}
            ${createPlayer('CB','centre-back')}
            ${createPlayer('RB','right-back')}
        </div>
        <div class="formation-row">
            ${createPlayer('GK','goalkeeper')}
        </div>`;
    }

    container.innerHTML = html;
    container.querySelectorAll('.player').forEach(p => setTimeout(() => p.classList.add('show'), 100));
}
</script>
</body>
</html>
